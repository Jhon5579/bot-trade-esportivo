# .github/workflows/atualizar_historico.yml

name: Atualizador de Dados Hist贸ricos

on:
  schedule:
    # Roda todo dia s 23:55 (hor谩rio do Brasil - 02:55 UTC)
    - cron: '55 2 * * *'
  workflow_dispatch:

jobs:
  rodar-arquivista:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Baixando o c贸digo do reposit贸rio
        uses: actions/checkout@v3
        with:
          # Permite que o workflow salve as altera莽玫es de volta no reposit贸rio
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 2. Configurando o ambiente Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 3. Instalando as depend锚ncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 4. Executando o Rob么 Arquivista
        run: python atualizar_historico.py

      - name: 5. Salvando as altera莽玫es no reposit贸rio
        run: |
          git config --global user.name 'Robo Falcao Arquivista'
          git config --global user.email 'actions@github.com'
          git add dados_historicos_corrigido.csv
          # Apenas faz o commit se houver alguma altera莽茫o no arquivo
          git diff-index --quiet HEAD || git commit -m " Atualiza莽茫o autom谩tica de dados hist贸ricos"
          git push