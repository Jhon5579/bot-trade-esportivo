# .github/workflows/atualizar_historico.yml

name: Atualizador de Dados Históricos

on:
  schedule:
    # Roda todo dia às 23:55 (horário do Brasil - 02:55 UTC)
    - cron: '55 2 * * *'
  workflow_dispatch:

jobs:
  rodar-arquivista:
    runs-on: ubuntu-latest
    steps:
      - name: 1. Baixando o código do repositório
        uses: actions/checkout@v3
        with:
          # Permite que o workflow salve as alterações de volta no repositório
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 2. Configurando o ambiente Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: 3. Instalando as dependências
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: 4. Executando o Robô Arquivista
        run: python atualizar_historico.py

      - name: 5. Salvando as alterações no repositório
        run: |
          git config --global user.name 'Robo Falcao Arquivista'
          git config --global user.email 'actions@github.com'
          git add dados_historicos_corrigido.csv
          # Apenas faz o commit se houver alguma alteração no arquivo
          git diff-index --quiet HEAD || git commit -m "📊 Atualização automática de dados históricos"
          git push